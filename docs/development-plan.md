# 电商系统开发计划（详细版）

## 📋 项目概览

**项目名称**：zjMall 电商微服务系统  
**当前进度**：约 10%（用户服务基本完成）  
**目标**：完成 MVP 版本，实现核心购物流程  
**预计时间**：2-3 个月（全职）或 6-9 个月（兼职）

---

## 🎯 开发阶段划分

### 阶段一：基础设施完善（1-2 周）
**目标**：完善基础架构，为后续开发做准备

#### 1.1 完善网关服务（3-5 天）
- [ ] 完善路由配置
- [ ] 实现服务发现集成（Nacos/Consul）
- [ ] 完善限流和熔断
- [ ] 完善日志和链路追踪
- [ ] 完善错误处理和统一响应

#### 1.2 完善用户服务（2-3 天）
- [ ] 完善用户信息更新接口
- [ ] 实现头像上传功能
- [ ] 完善错误处理和日志
- [ ] 添加单元测试

#### 1.3 配置管理优化（1-2 天）
- [ ] 完善配置中心集成
- [ ] 实现配置热更新
- [ ] 环境配置分离（dev/test/prod）

**里程碑**：✅ 基础设施完善，网关和用户服务稳定运行

---

### 阶段二：商品服务开发（2-3 周）
**目标**：完成商品核心功能，支持商品浏览和详情查看

#### 2.1 Proto 定义（1-2 天）
- [ ] 定义商品服务 Proto 文件
  - [ ] ProductService（商品 CRUD）
  - [ ] CategoryService（类目管理）
  - [ ] BrandService（品牌管理）
  - [ ] SKUService（SKU 管理）
- [ ] 生成 gRPC 代码

#### 2.2 Model 层（2-3 天）
- [ ] 创建 Category Model
- [ ] 创建 Brand Model
- [ ] 创建 Product Model（SPU）
- [ ] 创建 SKU Model
- [ ] 创建 Attribute Model
- [ ] 创建关联表 Model

#### 2.3 Repository 层（3-4 天）
- [ ] CategoryRepository（类目 CRUD）
- [ ] BrandRepository（品牌 CRUD）
- [ ] ProductRepository（商品 CRUD）
- [ ] SKURepository（SKU CRUD）
- [ ] 实现缓存策略（Redis）

#### 2.4 Service 层（4-5 天）
- [ ] CategoryService（类目树查询）
- [ ] BrandService（品牌管理）
- [ ] ProductService（商品管理、上下架）
- [ ] SKUService（SKU 管理、价格查询）
- [ ] 实现业务逻辑和校验

#### 2.5 Handler 层（2-3 天）
- [ ] 实现 gRPC Handler
- [ ] 参数校验
- [ ] 错误处理

#### 2.6 主程序（1 天）
- [ ] 创建 main.go
- [ ] 配置服务启动
- [ ] 注册 gRPC 服务

#### 2.7 测试和优化（2-3 天）
- [ ] 单元测试
- [ ] 接口测试
- [ ] 性能优化（缓存、索引）

**里程碑**：✅ 商品服务完成，支持商品浏览、详情查看、类目查询

---

### 阶段三：购物车服务（1-2 周）
**目标**：实现购物车功能，支持加购、修改、删除

#### 3.1 Proto 定义（1 天）
- [ ] 定义 CartService Proto
- [ ] 生成 gRPC 代码

#### 3.2 Model 层（1 天）
- [ ] 创建 CartItem Model
- [ ] 设计缓存结构

#### 3.3 Repository 层（2-3 天）
- [ ] CartRepository（基于 Redis）
- [ ] 实现购物车 CRUD
- [ ] 实现跨端合并逻辑

#### 3.4 Service 层（3-4 天）
- [ ] CartService（加购、修改、删除）
- [ ] 价格试算（调用商品服务和促销服务）
- [ ] 库存校验（调用库存服务）

#### 3.5 Handler 层（1-2 天）
- [ ] 实现 gRPC Handler
- [ ] 参数校验

#### 3.6 主程序（1 天）
- [ ] 创建 main.go
- [ ] 配置服务启动

**里程碑**：✅ 购物车服务完成，支持完整的购物车操作

---

### 阶段四：库存服务（1.5-2 周）
**目标**：实现库存管理，支持防超卖

#### 4.1 Proto 定义（1 天）
- [ ] 定义 InventoryService Proto
- [ ] 生成 gRPC 代码

#### 4.2 Model 层（1-2 天）
- [ ] 创建 Inventory Model
- [ ] 创建 InventoryLock Model（预占记录）
- [ ] 设计库存表结构

#### 4.3 Repository 层（3-4 天）
- [ ] InventoryRepository（库存 CRUD）
- [ ] 实现库存预占逻辑
- [ ] 实现库存扣减逻辑
- [ ] 实现幂等控制

#### 4.4 Service 层（4-5 天）
- [ ] InventoryService（库存查询）
- [ ] 库存预占（PreReserve）
- [ ] 库存解占（Release）
- [ ] 库存扣减（Deduct）
- [ ] 防超卖逻辑
- [ ] 超时自动解占（定时任务）

#### 4.5 Handler 层（1-2 天）
- [ ] 实现 gRPC Handler

#### 4.6 主程序（1 天）
- [ ] 创建 main.go
- [ ] 配置定时任务

**里程碑**：✅ 库存服务完成，支持防超卖和库存管理

---

### 阶段五：订单服务（2-3 周）
**目标**：实现订单创建和管理，核心业务逻辑

#### 5.1 Proto 定义（1-2 天）
- [ ] 定义 OrderService Proto
- [ ] 生成 gRPC 代码

#### 5.2 Model 层（2-3 天）
- [ ] 创建 Order Model（主订单）
- [ ] 创建 OrderItem Model（订单项）
- [ ] 创建 OrderLog Model（订单日志）
- [ ] 设计订单状态机

#### 5.3 Repository 层（3-4 天）
- [ ] OrderRepository（订单 CRUD）
- [ ] 实现订单查询（列表、详情）
- [ ] 实现订单状态更新

#### 5.4 Service 层（5-7 天）
- [ ] OrderService（订单创建）
  - [ ] 参数校验（地址、商品、库存）
  - [ ] 价格重算（调用商品、促销服务）
  - [ ] 库存预占（调用库存服务）
  - [ ] 订单创建
  - [ ] 订单号生成
- [ ] 订单查询（列表、详情）
- [ ] 订单取消（超时取消、手动取消）
- [ ] 订单状态机管理
- [ ] 分布式事务处理（Outbox 模式）

#### 5.5 Handler 层（2-3 天）
- [ ] 实现 gRPC Handler
- [ ] 参数校验
- [ ] 错误处理

#### 5.6 主程序（1 天）
- [ ] 创建 main.go
- [ ] 配置定时任务（超时取消）

#### 5.7 测试和优化（2-3 天）
- [ ] 单元测试
- [ ] 集成测试
- [ ] 并发测试

**里程碑**：✅ 订单服务完成，支持订单创建、查询、取消

---

### 阶段六：支付服务（1.5-2 周）
**目标**：实现支付功能，对接支付渠道（沙箱环境）

#### 6.1 Proto 定义（1 天）
- [ ] 定义 PaymentService Proto
- [ ] 生成 gRPC 代码

#### 6.2 Model 层（1-2 天）
- [ ] 创建 Payment Model（支付单）
- [ ] 创建 PaymentLog Model（支付日志）

#### 6.3 Repository 层（2-3 天）
- [ ] PaymentRepository（支付单 CRUD）
- [ ] 实现支付单查询

#### 6.4 Service 层（4-5 天）
- [ ] PaymentService（支付创建）
- [ ] 支付渠道对接（支付宝/微信沙箱）
- [ ] 支付回调处理
- [ ] 支付超时取消
- [ ] 支付状态查询

#### 6.5 Handler 层（1-2 天）
- [ ] 实现 gRPC Handler
- [ ] 回调接口处理

#### 6.6 主程序（1 天）
- [ ] 创建 main.go
- [ ] 配置回调路由

**里程碑**：✅ 支付服务完成，支持支付和回调处理

---

### 阶段七：服务集成和联调（1-2 周）
**目标**：完成服务间集成，实现完整购物流程

#### 7.1 服务间调用（3-5 天）
- [ ] 订单服务调用商品服务
- [ ] 订单服务调用库存服务
- [ ] 订单服务调用支付服务
- [ ] 购物车服务调用商品服务
- [ ] 完善错误处理和重试机制

#### 7.2 消息队列集成（2-3 天）
- [ ] 集成 Kafka/RocketMQ
- [ ] 订单创建事件
- [ ] 支付成功事件
- [ ] 库存扣减事件

#### 7.3 端到端测试（3-5 天）
- [ ] 完整购物流程测试
  - [ ] 浏览商品 → 加购 → 下单 → 支付 → 完成
- [ ] 异常场景测试
- [ ] 性能测试

**里程碑**：✅ 完整购物流程打通，系统可运行

---

### 阶段八：优化和完善（1-2 周）
**目标**：性能优化、监控完善、部署准备

#### 8.1 性能优化（3-5 天）
- [ ] 数据库索引优化
- [ ] 缓存策略优化
- [ ] 接口性能优化
- [ ] 并发处理优化

#### 8.2 监控和日志（3-5 天）
- [ ] 集成 Prometheus
- [ ] 集成日志系统（Loki/ELK）
- [ ] 添加链路追踪
- [ ] 配置告警规则

#### 8.3 部署配置（2-3 天）
- [ ] 完善 Docker 配置
- [ ] 完善 docker-compose.yml
- [ ] 配置环境变量
- [ ] 编写部署文档

#### 8.4 文档完善（2-3 天）
- [ ] API 文档
- [ ] 部署文档
- [ ] 开发文档
- [ ] 运维文档

**里程碑**：✅ 系统优化完成，可部署上线

---

## 📊 开发优先级

### P0（必须完成 - MVP 核心）
1. ✅ 用户服务（已完成）
2. 商品服务
3. 购物车服务
4. 库存服务
5. 订单服务
6. 支付服务（沙箱）

### P1（重要 - 提升体验）
7. 搜索服务（基础版）
8. 促销服务（简化版）

### P2（可选 - 后续完善）
9. 售后服务
10. 评价服务
11. 履约/物流服务
12. 运营配置服务

---

## 🗓️ 时间线（全职开发）

| 阶段 | 时间 | 累计时间 |
|------|------|---------|
| 阶段一：基础设施完善 | 1-2 周 | 1-2 周 |
| 阶段二：商品服务 | 2-3 周 | 3-5 周 |
| 阶段三：购物车服务 | 1-2 周 | 4-7 周 |
| 阶段四：库存服务 | 1.5-2 周 | 5.5-9 周 |
| 阶段五：订单服务 | 2-3 周 | 7.5-12 周 |
| 阶段六：支付服务 | 1.5-2 周 | 9-14 周 |
| 阶段七：服务集成 | 1-2 周 | 10-16 周 |
| 阶段八：优化完善 | 1-2 周 | 11-18 周 |

**总计**：约 2.5-4.5 个月（全职）

---

## 🗓️ 时间线（兼职开发）

| 阶段 | 时间 | 累计时间 |
|------|------|---------|
| 阶段一：基础设施完善 | 2-3 周 | 2-3 周 |
| 阶段二：商品服务 | 4-6 周 | 6-9 周 |
| 阶段三：购物车服务 | 2-3 周 | 8-12 周 |
| 阶段四：库存服务 | 3-4 周 | 11-16 周 |
| 阶段五：订单服务 | 4-6 周 | 15-22 周 |
| 阶段六：支付服务 | 3-4 周 | 18-26 周 |
| 阶段七：服务集成 | 2-3 周 | 20-29 周 |
| 阶段八：优化完善 | 2-3 周 | 22-32 周 |

**总计**：约 5.5-8 个月（兼职，每天 2-3 小时）

---

## 📝 每周检查清单

### 每周开始
- [ ] 回顾上周进度
- [ ] 制定本周目标
- [ ] 更新开发计划

### 每周结束
- [ ] 检查本周完成情况
- [ ] 记录遇到的问题
- [ ] 更新项目进度

---

## 🚨 风险提示

### 技术风险
1. **分布式事务**：订单、库存、支付的协调
   - 解决方案：使用 Outbox 模式 + 消息队列
2. **防超卖**：高并发下的库存管理
   - 解决方案：Redis 分布式锁 + 数据库乐观锁
3. **性能瓶颈**：高并发场景下的性能问题
   - 解决方案：缓存、数据库优化、异步处理

### 进度风险
1. **时间估算不准确**：实际开发时间可能超出预期
   - 建议：预留 20-30% 的缓冲时间
2. **技术难点**：遇到未预料的技术问题
   - 建议：提前调研，预留学习时间

---

## 📚 参考资料

- [用户服务 PRD](./user-service-prd.md)
- [商品服务 PRD](./product-service-prd.md)
- [商品服务技术设计](./product-service-tech-design.md)
- [电商架构设计](./ecommerce-architecture.md)
- [电商需求文档](./ecommerce-prd.md)

---

## ✅ 进度跟踪

**最后更新**：2024-12-19  
**当前阶段**：阶段一 - 基础设施完善  
**完成度**：10%

### 已完成
- ✅ 用户服务（注册、登录、地址管理）
- ✅ 网关服务（基础框架）

### 进行中
- 🔄 完善网关服务
- 🔄 完善用户服务

### 待开始
- ⏳ 商品服务
- ⏳ 购物车服务
- ⏳ 库存服务
- ⏳ 订单服务
- ⏳ 支付服务

---

**祝开发顺利！** 🚀

