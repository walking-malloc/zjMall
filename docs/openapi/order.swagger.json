{
  "swagger": "2.0",
  "info": {
    "title": "api/proto/order/order.proto",
    "version": "version not set"
  },
  "tags": [
    {
      "name": "OrderService"
    }
  ],
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/api/v1/orders": {
      "get": {
        "summary": "查询我的订单列表（用户侧）",
        "operationId": "OrderService_ListUserOrders",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/order.v1.ListUserOrdersResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/google.rpc.Status"
            }
          }
        },
        "parameters": [
          {
            "name": "status",
            "description": "过滤状态（0 表示全部）",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "int32"
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "int32"
          },
          {
            "name": "pageSize",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "int32"
          }
        ],
        "tags": [
          "OrderService"
        ]
      },
      "post": {
        "summary": "创建订单（从购物车或直接购买）",
        "operationId": "OrderService_CreateOrder",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/order.v1.CreateOrderResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/google.rpc.Status"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/order.v1.CreateOrderRequest"
            }
          }
        ],
        "tags": [
          "OrderService"
        ]
      }
    },
    "/api/v1/orders/token": {
      "get": {
        "summary": "生成订单幂等性Token",
        "operationId": "OrderService_GenerateOrderToken",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/order.v1.GenerateOrderTokenResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/google.rpc.Status"
            }
          }
        },
        "tags": [
          "OrderService"
        ]
      }
    },
    "/api/v1/orders/{orderNo}": {
      "get": {
        "summary": "获取单个订单详情",
        "operationId": "OrderService_GetOrder",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/order.v1.GetOrderResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/google.rpc.Status"
            }
          }
        },
        "parameters": [
          {
            "name": "orderNo",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "OrderService"
        ]
      }
    },
    "/api/v1/orders/{orderNo}/cancel": {
      "post": {
        "summary": "用户取消订单（待支付）",
        "operationId": "OrderService_CancelOrder",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/order.v1.CancelOrderResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/google.rpc.Status"
            }
          }
        },
        "parameters": [
          {
            "name": "orderNo",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/order.v1.OrderService.CancelOrderBody"
            }
          }
        ],
        "tags": [
          "OrderService"
        ]
      }
    },
    "/api/v1/orders/{orderNo}/pay": {
      "post": {
        "summary": "支付成功回调（由支付服务调用）",
        "operationId": "OrderService_MarkOrderPaid",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/order.v1.MarkOrderPaidResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/google.rpc.Status"
            }
          }
        },
        "parameters": [
          {
            "name": "orderNo",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/order.v1.OrderService.MarkOrderPaidBody"
            }
          }
        ],
        "tags": [
          "OrderService"
        ]
      }
    }
  },
  "definitions": {
    "google.protobuf.Any": {
      "type": "object",
      "properties": {
        "@type": {
          "type": "string"
        }
      },
      "additionalProperties": {}
    },
    "google.rpc.Status": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "details": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/google.protobuf.Any"
          }
        }
      }
    },
    "order.v1.CancelOrderResponse": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        }
      }
    },
    "order.v1.CreateOrderItemInput": {
      "type": "object",
      "properties": {
        "cartItemId": {
          "type": "string",
          "title": "购物车项ID（从购物车提交时使用）"
        },
        "productId": {
          "type": "string",
          "title": "商品ID（立即购买时使用）"
        },
        "skuId": {
          "type": "string",
          "title": "SKU ID"
        },
        "quantity": {
          "type": "integer",
          "format": "int32",
          "title": "购买数量"
        }
      },
      "title": "创建订单"
    },
    "order.v1.CreateOrderRequest": {
      "type": "object",
      "properties": {
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/order.v1.CreateOrderItemInput"
          },
          "title": "下单商品列表"
        },
        "addressId": {
          "type": "string",
          "title": "收货地址ID"
        },
        "couponId": {
          "type": "string",
          "title": "优惠券ID（可选）"
        },
        "buyerRemark": {
          "type": "string",
          "title": "买家留言"
        },
        "token": {
          "type": "string"
        }
      }
    },
    "order.v1.CreateOrderResponse": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "orderNo": {
          "type": "string"
        },
        "payAmount": {
          "type": "string"
        }
      }
    },
    "order.v1.GenerateOrderTokenResponse": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "token": {
          "type": "string",
          "title": "幂等性Token"
        },
        "expireSeconds": {
          "type": "string",
          "format": "int64",
          "title": "Token有效期（秒）"
        }
      }
    },
    "order.v1.GetOrderResponse": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "order": {
          "$ref": "#/definitions/order.v1.Order"
        },
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/order.v1.OrderItem"
          }
        }
      }
    },
    "order.v1.ListUserOrdersResponse": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "orders": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/order.v1.Order"
          }
        },
        "total": {
          "type": "integer",
          "format": "int32"
        }
      }
    },
    "order.v1.MarkOrderPaidResponse": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        }
      }
    },
    "order.v1.Order": {
      "type": "object",
      "properties": {
        "orderNo": {
          "type": "string",
          "title": "订单号"
        },
        "userId": {
          "type": "string",
          "title": "用户ID"
        },
        "status": {
          "$ref": "#/definitions/order.v1.OrderStatus",
          "title": "订单状态"
        },
        "totalAmount": {
          "type": "string",
          "title": "商品总金额"
        },
        "discountAmount": {
          "type": "string",
          "title": "优惠总金额"
        },
        "shippingAmount": {
          "type": "string",
          "title": "运费金额"
        },
        "payAmount": {
          "type": "string",
          "title": "应付金额"
        },
        "payChannel": {
          "type": "string",
          "title": "支付渠道（预留）"
        },
        "receiverName": {
          "type": "string",
          "title": "收货人姓名快照"
        },
        "receiverPhone": {
          "type": "string",
          "title": "收货人电话快照"
        },
        "receiverAddress": {
          "type": "string",
          "title": "收货地址快照（拼接好的全地址）"
        },
        "buyerRemark": {
          "type": "string",
          "title": "买家留言"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "title": "创建时间"
        },
        "paidAt": {
          "type": "string",
          "format": "date-time",
          "title": "支付时间"
        },
        "shippedAt": {
          "type": "string",
          "format": "date-time",
          "title": "发货时间"
        },
        "completedAt": {
          "type": "string",
          "format": "date-time",
          "title": "完成时间"
        }
      },
      "title": "订单主信息"
    },
    "order.v1.OrderItem": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "title": "明细ID"
        },
        "orderNo": {
          "type": "string",
          "title": "订单号"
        },
        "productId": {
          "type": "string",
          "title": "商品ID"
        },
        "skuId": {
          "type": "string",
          "title": "SKU ID"
        },
        "productTitle": {
          "type": "string",
          "title": "商品标题快照"
        },
        "productImage": {
          "type": "string",
          "title": "商品图片快照"
        },
        "skuName": {
          "type": "string",
          "title": "SKU 名称快照"
        },
        "price": {
          "type": "string",
          "title": "商品单价（下单时）"
        },
        "quantity": {
          "type": "integer",
          "format": "int32",
          "title": "购买数量"
        },
        "subtotalAmount": {
          "type": "string",
          "title": "小计金额（price * quantity - 分摊优惠）"
        }
      },
      "title": "订单商品明细"
    },
    "order.v1.OrderService.CancelOrderBody": {
      "type": "object",
      "properties": {
        "reason": {
          "type": "string"
        }
      },
      "title": "取消订单"
    },
    "order.v1.OrderService.MarkOrderPaidBody": {
      "type": "object",
      "properties": {
        "payChannel": {
          "type": "string"
        },
        "payTradeNo": {
          "type": "string"
        }
      },
      "title": "标记订单已支付"
    },
    "order.v1.OrderStatus": {
      "type": "string",
      "enum": [
        "ORDER_STATUS_UNSPECIFIED",
        "ORDER_STATUS_PENDING_PAY",
        "ORDER_STATUS_PAID",
        "ORDER_STATUS_SHIPPED",
        "ORDER_STATUS_COMPLETED",
        "ORDER_STATUS_CANCELLED",
        "ORDER_STATUS_REFUNDING",
        "ORDER_STATUS_REFUNDED",
        "ORDER_STATUS_CLOSED"
      ],
      "default": "ORDER_STATUS_UNSPECIFIED",
      "description": "- ORDER_STATUS_UNSPECIFIED: 未指定（保留）\n - ORDER_STATUS_PENDING_PAY: 正向流程\n\n待支付（可取消）\n - ORDER_STATUS_PAID: 已支付（可退款）\n - ORDER_STATUS_SHIPPED: 已发货（可收货/退货）\n - ORDER_STATUS_COMPLETED: 已完成（不可修改）\n - ORDER_STATUS_CANCELLED: 逆向流程\n\n已取消（用户主动）\n - ORDER_STATUS_REFUNDING: 退款中\n - ORDER_STATUS_REFUNDED: 已退款\n - ORDER_STATUS_CLOSED: 已关闭（超时自动）",
      "title": "订单状态枚举"
    }
  }
}
